{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/historico.css' %}">
    <title>HISTORICO SCI</title>
</head>
<body>
    {% include 'base/base.html' %}
    <div class="fundo-historico">
        <div class="historico-container">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Buscar...">
            </div>
            <table class="historico-tabela">
                <thead>
                    <tr>
                        <th>Chats</th>
                        <th>Data</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="historicoTableBody">
                    {% for historico in historicos %}
                    <tr>
                        <td data-label="Chats">{{ historico.prompt }}</td>
                        <td data-label="Data">{{ historico.sent|date:"d/m/Y" }}</td>
                        <td class="alinhar-fotos" data-label="Ações">
                            <a href="#"><img src="{% static 'media/download.svg' %}" alt="Download" title="Download"></a> 
                            <a href="#"><img src="{% static 'media/view.svg' %}" alt="View" title="Visualizar"></a>
                            <a href="#"><img src="{% static 'media/edit.svg' %}" alt="Editar" title="Editar"></a>
                            <form action="{% url 'sci_delete' historico.id %}" method="POST" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" onclick="return confirm('Você tem certeza que deseja deletar este item?');" style="background:none; border:none; padding:0;">
                                    <img src="{% static 'media/delete.svg' %}" alt="Deletar" title="Deletar" style="width: 24px; height: 24px;">
                                </button>
                            </form>
                        </td>                    
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div id="paginationControls" class="pagination-controls"></div>
        </div>
    </div>
</body>
<script>
    const rowsPerPage = 10;
    let currentPage = 1;

    const tableBody = document.getElementById('historicoTableBody');
    const rows = Array.from(tableBody.getElementsByTagName('tr'));
    let filteredRows = [...rows];
    const totalPages = Math.ceil(filteredRows.length / rowsPerPage);

    function showPage(page, rowsToShow) {
        currentPage = page;
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;

        rows.forEach(row => row.style.display = 'none'); // Hide all rows
        rowsToShow.slice(start, end).forEach(row => row.style.display = ''); // Show only the rows for the current page

        document.getElementById('paginationControls').innerHTML = createPaginationControls(totalPages, currentPage);
    }

    function createPaginationControls(totalPages, currentPage) {
        let controls = '';
        for (let i = 1; i <= totalPages; i++) {
            controls += `<button onclick="showPage(${i}, filteredRows)" class="${i === currentPage ? 'active' : ''}">${i}</button>`;
        }
        return controls;
    }

    function filterRows() {
        const filter = document.getElementById('searchInput').value.toUpperCase();
        filteredRows = rows.filter(row => {
            const cells = row.getElementsByTagName('td');
            for (let cell of cells) {
                if (cell.textContent.toUpperCase().includes(filter)) {
                    return true;
                }
            }
            return false;
        });

        const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
        showPage(1, filteredRows);
    }

    document.getElementById('searchInput').addEventListener('keyup', filterRows);

    document.addEventListener('DOMContentLoaded', function() {
        showPage(currentPage, filteredRows);
    });

    window.showPage = showPage;
</script>
</html>

